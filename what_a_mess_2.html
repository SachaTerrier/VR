<html>
  <head>

  

    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    

    <script>
        // le script ci dessous a été fait a l'aide de l'IA pour generer aleatoirement les modele 3d dans les cube a chaque nouveau charagement de la scene : la position , la rotation et la taille sont aleatoires
      AFRAME.registerComponent('spawn-insects', {
        init: function () {
          const sceneEl = this.el;

          // fonction qui crée les insectes
          const spawnInsects = () => {
            for (let i = 0; i < 70; i++) {
              const insect = document.createElement('a-entity');

              // positions aleatoire
              const x = Math.random() * 3 - 1.8;
              const y = Math.random() * 3; 
              const z = Math.random() * 3 - 1.5;

              // taille aleatoire
              const s = (Math.random() * 0.8 + 0.3).toFixed(2);

              // rotation aléatoire 
              const ry = (Math.random() * 180).toFixed(2);
               const rz = (Math.random() * 180).toFixed(2);
                const rx = (Math.random() * 180).toFixed(2);
              // spawn les modeles 3d selon les parametre definit precedement
              insect.setAttribute('gltf-model', '#insect-glb');
              insect.setAttribute('position', `${x} ${y} ${z}`);
              insect.setAttribute('scale', `${s} ${s} ${s}`);
              insect.setAttribute('rotation', `${rx} ${ry} ${rz}`);

              // attendre que le modèle soit chargé avant d'ajouter le corps physique
              insect.addEventListener('model-loaded', () => {
                // on utilise un collider de type box pour stabilité/perf
                insect.setAttribute('dynamic-body');
              });

              sceneEl.appendChild(insect);
            }
          };

          // chargement des asset
          const assetsEl = document.querySelector('a-assets');
          if (assetsEl) {
            assetsEl.addEventListener('loaded', spawnInsects);
            if (assetsEl.hasLoaded) spawnInsects(); 
          } else {
            
            sceneEl.addEventListener('loaded', spawnInsects);
          }
        }
      });
    </script>
  </head>

  <body>
    <!-- model et images-->
    <a-scene spawn-insects>
      <a-assets>
        <a-asset-item id="insect-glb" src="assets/3Dmodels/millepatte.glb"></a-asset-item>
         <img id="scolopendre" src="assets/img/insect.jpg">

      </a-assets>

      <!-- sol -->
      <a-plane static-body position="0 0 0" rotation="-90 0 0" width="3" height="3" color="black"></a-plane>

      <!-- murs du cube  -->
      <a-plane  src="#scolopendre"  material="side: double" position="0 1.5 -1.5" rotation="0 0 0" width="3" height="3"></a-plane>
      <a-plane  src="#scolopendre"  material="side: double" position="1.5 1.5 0" rotation="0 -90 0" width="3" height="3"></a-plane>
      <a-plane  src="#scolopendre" material="side: double" position="-1.5 1.5 0" rotation="0 90 0" width="3" height="3"></a-plane>
      <a-plane  src="#scolopendre" material="side: double" position="0 1.5 1.5" rotation="0 180 0" width="3" height="3"></a-plane>

      
      <a-plane static-body position="0 3 0" rotation="90 0 0" width="3" height="3" color="black"></a-plane>

      <!-- caméra -->
      <a-entity camera look-controls wasd-controls="acceleration: 9" position="0 1.5 0"></a-entity>
      
      

      <a-sky color="brown"></a-sky>
    </a-scene>
  </body>
</html>